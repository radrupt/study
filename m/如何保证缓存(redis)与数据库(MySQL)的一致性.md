![chanimg](img/如何保证缓存(redis)与数据库(MySQL)的一致性.png)

1. 先更新数据库
2. 淘汰缓存

情形1：
A线程更新数据库
B线程读cache（此时数据不一致）
A线程淘汰缓存
C线程读数据库（新数据）
C线程写cache
情形2：
A线程正在更新数据库，还未更新成功
B线程读cache（此时数据一致）
情形3：
A线程读数据，缓存没数据，先从数据库读
A线程还没有读成功
B线程写数据库，更新缓存
A再读成功，数据是最小数据
情形4
A线程读数据，缓存没数据，线程数据库读
A线程读数据库成功
B线程写数据
B线程淘汰缓存
A线程更新缓存（旧数据）
需要缓存双删来保证

1. 先淘汰缓存
2. 再更新数据库

使用binlog来将数据库数据的变化同步更新到redis
且只有数据库数据变动才能写redis

A线程读数据
B线程写数据
B线程淘汰cache
A返回的是相对A时候的最新值，一致
订阅binlog，更新cache
C线程读数据，一致

缺点：大量读请求打到了数据库
好处，完全一致

